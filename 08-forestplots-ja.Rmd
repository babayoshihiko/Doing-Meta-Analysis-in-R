# フォレストプロット {#forest} 

---

<img src="_figs/forest2.jpg" />

<br></br>

\index{Forest Plot}

<span class="firstcharacter">前</span>
章では、 _R_ で効果量をプールする方法と、メタ分析で異質性を評価する方法について学んだ。ここからは、メタ分析の中でも、前のステップで得た結果を可視化する楽しい部分である。

メタ分析を可視化する最も一般的な方法は、**フォレストプロット**である。このプロットは、観察された効果、信頼区間、そして通常は各研究の重み付けをグラフィカルに表示すものである。また、メタ分析で計算されたプール効果も表示される。全体として、この図によって、含まれる研究の精度や広がり、プールされた効果が観察された効果量とどのように関連しているのかを素早く調べることが可能である。

\index{meta Package}

**{meta}** パッケージには、 _R_ で直接美しいフォレストプロットを非常に簡単に作成するための関数が組み込まれている。この関数は幅広い機能を持ち、プロットの外観を好きなように変更することが可能である。このフォレストプロット関数と、それを実際にどのように使うことができるかが、この章の主な焦点である。さらに、メタ分析の結果を可視化するための別のアプローチについても簡単に説明した。

<br></br>

## フォレスト・プロットとは？

---

Figure \@ref(fig:forest) は、フォレストプロットの主な構成要素を示している。フォレストプロットの左側には、メタ分析に含まれる各研究の名前が表示される。各研究について、通常はプロットの中央に効果量のグラフが表示される。この可視化は、x軸に研究の点推定値を示している。この点推定値は、観察された効果量に対して計算された信頼区間の範囲を示す線によって補完されている。通常、点推定値は四角で囲まれている。この四角の大きさは効果量の重み（Chapter \@ref(fem)）で決まり、重みの大きな研究では大きな四角が、重みの小さな研究では小さな四角が与えられる。

通常、フォレストプロットにはメタ分析に使用した効果量のデータも含まれるはずである。これにより、私たちの結果を再現するために必要なデータを他の人に提供することが可能である。

```{r forest, out.width='100%', message = F, echo = F, fig.align='center', fig.cap = "Key elements of a forest plot."}
library(OpenImageR)
knitr::include_graphics('images/forest_sep.png')
```

プロットの下部には、菱形が平均効果を表している。菱形の長さは、X軸上のプールされた結果の信頼区間を象徴している。通常、フォレスト・プロットは垂直の**参照線**も含み、これはx軸上の点が効果がないことに等しいことを示している。これからの例で見るように、フォレストプロットは、例えば、$I^2$ や $\tau^2$ のような不均一性指標を表示すことによって、さらに強化することができる。

\index{Logarithm, Natural}

フォレスト・プロットにおける効果量と信頼区間は、通常、線形スケールで表示される。しかし、要約尺度が**比**（オッズ比やリスク比など）である場合、代わりにX軸に**対数**スケールを使用することが一般的である。これは、1よりずっと低い値や高い値よりも、1付近の値がより密接に関係していることを意味する。

効果量の測定基準は "線形"に解釈することができないので、これは比率に意味がある（すなわち、RR = 0.50の「反対」は1.5ではなく2である； Chapter \@ref(ratios) を参照）。このような効果量の基準線は、通常1であり、これは効果がないことを示す。

<br></br>

##  _R_  のフォレストプロット {#forest-R}

---

メタ分析オブジェクト（例：`metagen`、`metacont`、`metabin` の結果）の種類に関わらず、 `forest.meta` 関数を使用してフォレストプロットを作成することが可能である（訳注: 関数名は `forest` でよい。一般に、 _R_ では、 `forest` 関数が `forest.meta` のようにドット以降にクラスを指定したものを自動的に読み込む。）。`forest.meta` に  **{meta}**  オブジェクトを渡すだけで、プロットが作成される。通常、これらのフォレストプロットはデフォルトですでに非常に良い見た目をしているが、この関数はさらに見た目を整えるための無数の追加引数を持っている。これらの引数はすべて関数のドキュメントに記載されている（`?forest.meta`を実行することでアクセス可能となる）。ここでは、より重要なものをリストアップしている。

* **`sortvar`**. メタ分析データセットの変数で、フォレストプロットで研究をソートするためのもの。例えば、効果量によって結果を並べ替えたい場合、`sortvar = TE` というコードを使用することが可能である。

* **`comb.fixed`**. 論理値で、固定効果モデルの推定値をプロットに含めるかどうかを示す。

* **`comb.random`**. ランダム効果モデルの推定値をプロットに含めるかどうかを論理的に示す。

* **`text.fixed`**. 固定効果モデルによるプール効果の**ラベル**を表示する。デフォルトでは `"Fixed effect model"` と表示される。

* **`text.random`**. ランダム効果モデルによるプール効果のラベル。デフォルトでは `"Random effects model"` と表示される。

* **`prediction`**. 論理値で、予測区間をプロットに追加するかどうかを示す。

* **`label.left`** と **`label.right`**. フォレストプロットの左側と右側に追加されるラベルである。これは、例えば、この側の効果は治療に有利であることを指定するために使用することが可能である（例： `label.left = "Favors treatment"`）。

* **`smlab`**. プロットの上に表示されるラベル。どの効果量メトリックを使用したかを示すために使用できる。

* **`xlim`**. x軸の限界値、または対称的なフォレストプロットを作成したいときは文字 `"s"` を指定する。結果がゼロから大きく外れている場合や、外れ値を表示させたい場合に関係する。例えば、x軸を0から2の範囲にしたい場合、コードは `xlim = c(0,2)` となる。

* **`ref`**. プロットにおける参照線。使用した要約尺度に依存し、デフォルトでは0または1のどちらかになる。

* **`leftcols`** と **`rightcols`**. ここでは、フォレストプロットの左側と右側に表示す変数を指定することが可能である。この関数がデフォルトで使用する要素がいくつかある。例えば、 `"studlab"` は研究のラベル、 `"effect"` は観測された効果量、 **`effect.ci`** は効果量とその信頼区間を表す。また、最初に **{meta}** 関数に提供した `data.frame` に含まれていれば、ユーザー定義の列を追加することも可能である。この場合、列の名前を文字列として追加するだけである。

* **`leftlabs`**と**`rightlabs`**. フォレストプロットの左側と右側に表示される列に使用されるラベル。

* **`print.I2`** と **`print.I2.ci`**. $I^2$ 値とその信頼区間を表示すかどうかを論理的に指定する。デフォルトでは `TRUE`。

* **`print.tau2`** と **`print.tau`**. 論理値で、$\tau^2$ と $\tau$ の値を表示すかどうかを指定する。デフォルトでは、$\tau^2$ の値を表示する。

* **`col.square`**, **`col.diamond`**, **`col.predict`**. それぞれ、正方形、菱形、予測区間の色（例: `"blue"`）を指定する。



最初のフォレストプロットを作成する時間である。この例では、前の例で使用した `m.gen` オブジェクトをプロットしている。フォレストプロットでは、効果量によって研究を並べ替え、予測区間を追加し、左側にユーザー定義のラベルを追加している。`forest.meta` 関数は、デフォルトで $\tau^2$ 値を出力したが、ここでは不要なので、`print.tau2` を `FALSE` に設定した。

最終的にこのようなコードになる。（訳注：原著では引数が間違っていた。`pdrediction` が正しい。）

```{r ch08-87, fig.height=6, fig.width=8, eval=F}
forest.meta(m.gen, 
            sortvar = TE,
            prediction = TRUE, 
            print.tau2 = FALSE,
            leftlabs = c("Author", "g", "SE"))
```

```{r ch08-95, fig.height=6, fig.width=8, echo=F}
par(bg="#FFFEFA")
forest(m.gen, 
       sortvar = TE,
       prediction = TRUE, 
       print.tau2 = FALSE,
       leftlabs = c("Author", "g", "SE"))
```


`forest.meta` のプロットは、すでにかなり良く見える。また、黒い線がプロットに追加され、プールされた効果の予測区間を表していることがわかる。

\index{Risk of Bias}


各研究のバイアスリスクを表示す列を追加することで、プロットを強化することが可能である。`m.gen` の生成に使用した `ThirdWave` データセットには、`RiskOfBias` という列があり、そこに各研究のバイアスリスク評価が保存されている。

メタ分析の計算に `metagen` を使用した場合 (Chapter \@ref(pre-calculated-es)) 、この関数は自動的にこのデータを `m.gen` 内に保存した。したがって、 `leftcols`  引数を使用して、プロットに列を追加することが可能である。この結果、次のようなコードになる。（訳注：ここも `forest.meta` 関数ではなく、`forest` 関数を使用している。）

```{r, fig.height=6, fig.width=9, eval=F, echo=F}
forest.meta(m.gen, 
            sortvar = TE,
            prediction = TRUE, 
            print.tau2 = FALSE,
            leftcols = c("studlab", "TE", "seTE", "RiskOfBias"),
            leftlabs = c("Author", "g", "SE", "Risk of Bias"))
```

```{r, fig.height=6, fig.width=9}
par(bg="#FFFEFA")
forest(m.gen, 
       sortvar = TE,
       prediction = TRUE, 
       print.tau2 = FALSE,
       leftcols = c("studlab", "TE", "seTE", "RiskOfBias"),
       leftlabs = c("Author", "g", "SE", "Risk of Bias"))
```


フォレストプロットに各研究のバイアスリスク情報が追加されたことがわかる。

\vspace{4mm}

<br></br>

### レイアウトの種類

---

`forest.meta` 関数には2つの 「パッケージ済み」レイアウトがあり、これを使用すると、多数の引数を指定することなくフォレストプロットを特定の形式にすることが可能である。そのうちの1つは `"JAMA"` レイアウトで、これは **Journal of the American Medical Association** のガイドラインに従ったフォレストプロットを提供するものである。このレイアウトは、メタ分析を医学雑誌に掲載したい場合に使用される。（訳注：ここは `forest.meta` 関数を使用している。）

\vspace{2mm}

```{r, eval=F}
forest.meta(m.gen, layout = "JAMA")
```

```{r, echo=F, fig.height=6, fig.width=8, out.width="75%", fig.align='center'}
par(bg="#FFFEFA")
forest.meta(m.gen, layout = "JAMA")
```

\index{Review Manager (RevMan)}

もう一つのレイアウトは `"RevMan5"` で、これはコクランの **Review Manager 5** で生成されるものと同様のフォレストプロットを生成する。

```{r, eval=F}
forest.meta(m.gen, layout = "RevMan5")
```

```{r, echo=F, fig.height=6, fig.width=9, out.width="75%", fig.align='center'}
par(bg="#FFFEFA")
forest.meta(m.gen, layout = "RevMan5")
```

<br></br>

### フォレスト・プロットを保存

---

`forest.meta` によって生成されたフォレストプロットは、PDF、PNG、または **scalable vector graphic** (SVG) ファイルとして保存することが可能である。base _R_ や **{ggplot2}** パッケージによって生成される他のプロットとは対照的に、`forest.meta` の出力はファイルとして保存する際に自動的にリスケーリングされていない。このため、フォレストプロットは2辺または4辺が切り取られることがあり、すべてが見えるように幅と高さを手動で調整する必要がある。

`pdf`、`png`、`svg` 関数を使用すると、 _R_ のコードでプロットを保存することが可能である。まず、これらの関数のいずれかをコールして、次のコードの出力をドキュメントに保存するように _R_ に指示す必要がある。そして、`forest.meta` 関数の呼び出しを追加する。最後の行では、 `dev.off()` をインクルードして、生成された出力を上記で指定したファイルに保存する。

3つの関数とも `file` という引数を指定する必要があり、その引数にはファイル名を指定する必要がある。この引数にはファイル名を指定する。ファイルは自動的に作業ディレクトリにその名前で保存される。さらに、 `width` と `height` 引数でプロットの大きさを対照することが可能であるので、出力が途切れるような場合に役立つ。

最初のフォレストプロットを "forestplot" という名前で保存すると仮定して、以下のコードでPDF、PNG、SVGファイルを生成することが可能である。

\vspace{2mm}

**PDF**

```{r, eval=F}
pdf(file = "forestplot.pdf", width = 8, height = 7)

forest.meta(m.gen, 
            sortvar = TE,
            predict = TRUE, 
            print.tau2 = FALSE,
            leftlabs = c("Author", "g", "SE"))

dev.off()
```

\vspace{2mm}

**PNG**

```{r, eval=F}
png(file = "forestplot.png", width = 2800, height = 2400, res = 300)

forest.meta(m.gen, 
            sortvar = TE,
            predict = TRUE, 
            print.tau2 = FALSE,
            leftlabs = c("Author", "g", "SE"))

dev.off()
```

\vspace{2mm}

**SVG**

```{r, eval=F}
svg(file = "forestplot.svg", width = 8, height = 7)

forest.meta(m.gen, 
            sortvar = TE,
            predict = TRUE, 
            print.tau2 = FALSE,
            leftlabs = c("Author", "g", "SE"))

dev.off()
```

<br></br>

## Drapery プロット {#drapery}

---

\index{Drapery Plot}

\index{P-Value}

フォレストプロットは、メタ分析を可視化する最も一般的な方法である。発表されたメタ分析のほとんどにフォレストプロットが含まれており、多くの研究者がその解釈方法を理解している。フォレストプロットは、調査結果の包括的で理解しやすい要約を提供するので、メタ分析レポートにもフォレストプロットを含めることが推奨される。

しかし、フォレストプロットだけが結果を説明する手段ではない。メタ分析は、例えば、**drapery plots** [@rucker2020beyond]などでも可視化することが可能である。フォレストプロットの欠点は、固定された有意閾値、慣習的に$p<$ 0.05を仮定した信頼区間しか表示できないことである。研究者は、これらの信頼区間に基づいて、効果が有意であるか否かを決定するのである。

近年、$p$ 値の利用をめぐる論争があり [@wellek2017critical]、$p$ 値に基づく仮説検定が多くの研究領域で「再現性の危機」に寄与しているという議論もある [@nuzzo2014statistical]。

Drapery プロットは、$p$-**値関数**に基づいている。このような $p$ 値関数は、解析結果を解釈する際に $p$ < 0.05 の有意性閾値だけに頼らないために提案されたものである [@infanger2019p]。

したがって、$p$ 値関数は95%信頼区間を計算するだけでなく、$p$ の値を変化させた場合の信頼区間を示す連続曲線を提供する。Drapery プロットでは、各研究の信頼曲線と平均効果の信頼曲線がプロットされる。x軸は効果量指標を示し、y軸は仮定された $p$ 値を示す。

Drapery プロットは、 **{meta}** の `drapery` 関数によって生成することが可能である。`forest.meta` と同様に、この関数に **{meta}** メタ分析オブジェクトを与えると、自動的にプロットが生成される。いくつかの追加引数があるが、最も重要なのは以下の通り。

* **`type`**: Y軸にプロットされる値の種類を定義する。これは、検定統計量の `"zvalue"` (デフォルト)、または $p$-value (`"pvalue"`) とすることが可能である。

* **`study.results`**: 論理値で、各研究の結果をプロットに含めるかどうかを指定する。FALSE` の場合、効果の要約のみが表示される。

* **`labels`**: この引数を `"studlab"` に設定すると、試験のラベルがプロットに含まれるようになる。

* **`legend`**: 凡例を表示すかどうかを示す論理値。

* **`pos.legend`**. 凡例の位置。`"bottomright"`, `"bottom"`, `"bottomleft"`, `"left"`, `"topleft"`, `"top"`, `"topright"`, `"right"`, または `"center"` のいずれかを指定する。

メタ分析オブジェクト `m.gen` を使って `drapery` 関数を試してみよう。


```{r, fig.align='center', eval=F}
drapery(m.gen, 
        labels = "studlab",
        type = "pval", 
        legend = FALSE)
```


```{r, fig.align='center', echo=F, fig.width=12, fig.height=8}
par(bg="#FFFEFA")
drapery(m.gen, 
        labels = "studlab",
        type = "pval", 
        legend = FALSE,
        bg = "#FFFEFA")
```

結果として得られるプロットは、各効果サイズの$p$-値曲線を含み、すべて逆さVの形をしている。太線はランダム効果モデルによる平均効果を表した。プロットで見られる斜線部分は予測区間で、プールされた効果の信頼区間よりもかなり広い。

$p$ 値関数の「ピーク」は、メタ分析における効果量の正確な値を表している。y軸を下に行くに従って、$p$ 値は小さくなり、信頼区間は広くなり、破線の水平線で示される従来の有意閾値に到達することになる。

$p$ がすでに非常に小さい（<0.01）ときに太線がx軸上でゼロになることから、プロットに基づいて、プールされた効果サイズがゼロより大きいことをかなり確信できることがわかる。

Rücker et al. [-@rucker2020beyond] は、drapery プロットは主にフォレストプロット**に加えて**使用すべきであると推奨している。なぜなら、フォレストプロットは、結果を再現するために必要とするかもしれない効果量情報をあまり含んでいないことがある。

$$\tag*{$\blacksquare$}$$

<br></br>

**知識を試そう！**問題

```{block, type='boxquestion'}
**Test your knowledge!**

\vspace{4mm}

1. フォレストプロットの主要な構成要素は何か？

\vspace{-2mm}

2. メタ分析でフォレストプロットを提示するメリットは何か？

\vspace{-2mm}

3. フォレストプロットの限界は何か、Drapery プロットはこの限界をどのように克服しているのか。

\vspace{4mm}


**問題の解答は、本書の巻末 [Appendix A](#qanda6) にある。**

```


<br></br>


## 要約

* メタ分析の結果は、フォレストプロットで可視化するのが一般的である。

* フォレストプロットは、各研究の効果量と信頼区間をグラフ化したもので、総合効果の計算値も表示される。さらに、プールに使用された効果量データも含まれる。

* フォレストプロットには、各研究が受けた品質評価など、他の種類の情報を追加することも可能である。

